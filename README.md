# eSUS-Docker
Implantando o e-SUS PEC em container Docker

Primeiro vamos criar a imagem do banco de dados que vai ser baseada no PostgreSQL versão 9.6.13-apine, para isso faça o build da imagem usando o Dockerfile que está na pasta database, entre na pasta e utilize o comando **_sudo docker build -t esus_database:1.0 ._**.

Agora vamos criar a imagem do webserver, o instalador do e-SUS para Linux necessita do **systemd** é por isso que vamos utilizar como base a imagem **centos/systemd** https://hub.docker.com/r/centos/systemd/, faça o build da imagem usando o Dockerfile que está na pasta webserver, entre na pasta e utilize o comando **_sudo docker build -t esus_webserver:1.0 ._**.

Coma as imagens criadas vamos agora criar os containers, mas antes precisamos criar uma network para que os dois containers possam se comunicar, faça isso utilizando o camando **_sudo docker network create esus_teste_**.
Agora vamos criar o container do banco de dados executando o comando **_sudo docker container run -d --name esus_teste_database -p 5433:5432 --net esus_teste --cpus=1 -m 1gb esus_database:1.0_**.
Na documentação da imagem do centos/systemd fala que precisamos executar o container em modo privilegiado para fazer isso devemos usar o parâmetro **--privileged** é necessário também que o container tenha as definições do **cgroup** por isso devemos criar um volume bindando o cgroup da máquina host para o container, o comando completo para criar o container é **_sudo docker container run -d --name esus_teste_webserver -v /sys/fs/cgroup/:/sys/fs/cgroup:ro --privileged --env APP_DB_URL=jdbc:postgresql://esus_teste_database:5432/esus --env APP_DB_USER=postgres --env APP_DB_PASSWORD=esus -p 8080:8080 --net esus_teste --cpus=1 -m 2gb esus_webserver:1.0_**.
Com os containers criados e em execução vamos acessar o container do webserver para fazer o download do instalado do e-SUS e realizar sua instalação, vamos baixar a ultima versão 4.5.10 disponível no momento da criação desse arquivo que está disponível no site https://sisaps.saude.gov.br/esus/.
Acessando o container **_sudo docker exec -it esus_teste_webserver /bin/bash_** entre na pasta downloads **_cd /home/downloads/_** e faça o download do instalador **_wget https://arquivos.esusab.ufsc.br/PEC/oIDuBoOygUfZYlQe/4.5.10/eSUS-AB-PEC-4.5.10-Linux64.jar --no-check-certificate_** após ser finalizado o download faça a instalação do e-SUS usando o commando **_java -jar eSUS-AB-PEC-4.5.10-Linux64.jar -console -url=$APP_DB_URL -username=$APP_DB_USER -password=$APP_DB_PASSWORD_** e é isso, ao finalizar a instalação aguarde uns instantes para o e-SUS terminar de iniciar e teste acessando no nagegador da máquina host http://localhost:8080 você vai ver a página inicial do sistema e-SUS.

**Observação:** Os nomes das imagens, containers e rede são de sua escolha assim como a bindagem da porta do webserver.
